Step 0: create a virtual environment
------------------------------------

Navigate to 

X:\abdominal_imaging\Shared\cluster-template

Create a venv:
(Note this takes a long time)

>> conda create --prefix ./venv python=3.11

Activate it:

>> conda activate ./venv

Install requirements:

>> pip install -r requirements.txt

Notes:
------

To check the content of the venv

>> conda list


Step 1: run the script locally
------------------------------

Activate venv

>> conda activate ./venv

Run scripts locally

>> python src/all_jobs.py
>> python src/one_job.py --num=1


Step 2: run the script on the HPC
---------------------------------

Log in to the HPC using

>> ssh -X md1spsx@stanage.shef.ac.uk

Then enter password and DUO code.

Once logged in go to shared dir:

>> cd /shared/abdominal_imaging/Shared/tutorial-cluster

Load conda

>> module load Anaconda3/2019.07

activate the venv

>> source activate venv

Run the scripts:

>> python src/all_jobs.py
>> python src/one_job.py --num=5

Note: to see installed modules

>> module list

To back to home dir

>> cd

Step 3: run the script as a job on the HPC
------------------------------------------

Issue: path needs to be mounted from a compute node

>> sbatch hpc/all_jobs.sh

Check jobs in the queue

>> squeue -u $USER

Check status of a completed job 8466582

>> sacct -j 8466582

# syntax-check the script (won't execute)
bash -n hpc/myscript.sh

# run it locally with tracing to see what would happen (safe test)
bash -x hpc/myscript.sh
